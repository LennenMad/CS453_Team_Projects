<!DOCTYPE html>
<html>
<head>
    <!--The head defines the page title, 
        sets the viewport to adaptive, 
        and includes a style guide for elements.-->
    <title>Class Simulation Diagram</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        table, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        td {
            padding: 7px;
        }
        table.center {
            margin-left: auto; 
            margin-right: auto;
            width: auto;
        }
    </style>
</head>
<div>
<body>
    <!--This table defines the diagram of a class room.-->
    <form id="class1" method="get" action="server.php">
    <table class="center">
        <tr>
            <td rowspan="4">
                Class 1 <br><br><br>
                Class:
                <button id="startClass" type="button" value="Start">Start</button>
                <button id="endClass" type="button" value="End">End</button> <br><br>
                Student:
                <button id="studentEnter" type="button" value="Enter">Enter</button>
                <button id="studentExit" type="button" value="Exit">Exit</button>
            </td>
            <td>Room Entrance: <input type="number" id="entrance" name="entrance" min="0" max="6" value="0"></input>
                <button id="sanitizer" type="button" value="Sanitizer">Sanitizer</button>
            </td>
            <td rowspan="3">Aisleway</td>
            <td>Instructor Rectangle:
                <input type="number" id="instructor" name="instructor" min="0" max="6" value="0"></input> <br>
                <button id="removeInstructor" type="button" value="-">-</button>
                <button id="addInstructor" type="button" value="+">+</button> &ThickSpace; &ThickSpace;
                <button id="instruMask" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="intruLysol" type="button" value="Lysol">Lysol</button>
            </td>
            <td colspan="2">Student Question Rectangle: 
                <input type="number" id="rectQ" name="rectQ" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudentQ" type="button" value="-">-</button>
                <button id="addStudentQ" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="questionMask" type="button" value="Mask">Mask</button>
            </td>
        </tr>
        <tr>
            <td>Student Rectangle #1: 
                <input type="number" id="rect1" name="rect1" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudent1" type="button" value="-">-</button>
                <button id="addStudent1" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="studMask1" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="studLysol1" type="button" value="Lysol">Lysol</button>
            </td>
            <td>Student Rectangle #2: 
                <input type="number" id="rect2" name="rect2" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudent2" type="button" value="-">-</button>
                <button id="addStudent2" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="studMask2" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="studLysol2" type="button" value="Lysol">Lysol</button>
            </td>
            <td rowspan="2">Aisleway</td>
            <td>Student Rectangle #3: 
                <input type="number" id="rect3" name="rect3" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudent3" type="button" value="-">-</button>
                <button id="addStudent3" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="studMask3" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="studLysol3" type="button" value="Lysol">Lysol</button>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>Student Rectangle #5: 
                <input type="number" id="rect5" name="rect5" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudent5" type="button" value="-">-</button>
                <button id="addStudent5" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="studMask5" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="studLysol5" type="button" value="Lysol">Lysol</button>
            </td>
            <td>Student Rectangle #4: 
                <input type="number" id="rect4" name="rect4" min="0" max="6" value="0"></input><br>
                <!-- <button id="removeStudent4" type="button" value="-">-</button>
                <button id="addStudent4" type="button" value="+">+</button> &ThickSpace; &ThickSpace; -->
                <button id="studMask4" type="button" value="Mask">Mask</button> &ThickSpace; &ThickSpace;
                <button id="studLysol4" type="button" value="Lysol">Lysol</button>
            </td>
        </tr>
        <tr>
            <td colspan="5" style="text-align:center">Aisleway</td>
        </tr>
    </table>
    </form>
</body>
</div>
<div>
<body id="test">
</body>
</div>
<script>
    //Potentially could use "onchange" event to check the number of students

    const buttonsCollec = document.getElementsByTagName("button");
    let inputCollec = document.getElementsByTagName("input");
    //console.log(buttonsCollec);

    //Adds an evevnt listern to the sanitizer button by id
    document.getElementById("sanitizer").addEventListener("click",sanitizerClicked);

    //Iterates through each button element and attaches the proper event listener to each.
    for (let i=0; i<buttonsCollec.length; i++) {
        //console.log(buttonsCollec.item(i));
        let someButtonElm = buttonsCollec.item(i);
        if (someButtonElm.id.includes("addStudent")){
            someButtonElm.addEventListener("click", addStudentClicked);
        } else if (someButtonElm.id.includes("removeStudent")){
            someButtonElm.addEventListener("click", removeStudentClicked);
        } else if (someButtonElm.id.includes("studentEnter")) {
            someButtonElm.addEventListener("click", studentEnterClicked);
        } else if (someButtonElm.id.includes("studentExit")) {
            someButtonElm.addEventListener("click", studentExitClicked);
        }
    }

    for (let i=0; i<inputCollec.length; i++) {
        let someInputElm = inputCollec.item(i);
        someInputElm.addEventListener("input", handleSomeInput);
    }

    function handleSomeInput() {
        let inputId = this.id
        if (inputId.includes("rect")){
            alert("Student changed.")
        }
        doAJAXsendForm();
    }

    //Function is called when the sanitizer button is pushed
    function sanitizerClicked() {
        alert("Sanitizer used.");
    }
    function addStudentClicked() {
        //Pass event.target.id to php function file to handle which cell is updated and check logic?

        doAJAXsendForm();
        alert("Student added.");
    }
    function removeStudentClicked() {
        doAJAXsendForm();
        alert("Student removed.");
    }
    function studentEnterClicked() {
        //Should this also be done through a php POST request?
        let entranceStudents = Number(document.getElementById("entrance").value);
        entranceStudents++;
        document.getElementById("entrance").value = entranceStudents;
        doAJAXsendForm();
        
    }
    function studentExitClicked() {
        let entranceStudents = Number(document.getElementById("entrance").value);
        entranceStudents--;
        document.getElementById("entrance").value = entranceStudents;
        doAJAXsendForm();
    }

    function doAJAXsendForm() {
        request = new XMLHttpRequest();
        let formData = new FormData(document.getElementById("class1"));

        request.open("GET","server.php?formData="+formData,true);

        request.onreadystatechange = function () {
            if (request.readyState == 4)
                my_callback();
        }
        request.send(formData);
    }

    function my_callback() {
        if (request.status == 200) {
            if (request.responseText.includes("<script>")) {
                document.append(request.responseText);
            }else {
                document.getElementById("test").append(request.responseText);
            }
            //alert(request.responseText);
        }
        else if (request.status=404) {
            alert("Server was not found: data returned is :\n"+request.responseText);
        }
    }
</script>
</html>
